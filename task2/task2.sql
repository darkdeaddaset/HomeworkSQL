INSERT INTO f (idcall, ks, dt, dur) VALUES
(150000, 111111, '2022-05-05 22:00:00+3', 15),
(150001, 111111, '2022-05-05 22:00:00+3', 20),
(150002, 111111, '2022-05-05 23:00:00+3', 2),
(150003, 111111, '2022-06-05 00:00:00+3', 4),
(150004, 111111, '2022-06-05 10:00:00+3', 1),
(150005, 111111, '2022-06-05 10:00:00+3', 40),
(150006, 111111, '2022-05-05 22:00:00+3', 15),
(150007, 111111, '2022-05-05 22:00:00+3', 30),
(150008, 111111, '2022-05-05 23:00:00+3', 2),
(150009, 111111, '2022-06-05 00:00:00+3', 35),
(150010, 111111, '2022-06-05 10:00:00+3', 1);

//task2
SELECT idcall, ks, dt, dur 
FROM 
(
	SELECT *, LAG(dur) OVER(PARTITION BY ks ORDER BY dt DESC) AS temp
	FROM f
) AS historycalls
WHERE dur > 30 AND temp < 5;